@model ONT_3rdyear_Project.ViewModels.ProgressViewModel
<link href="/css/Nurse1Sister/Progress.css" rel="stylesheet" />
<div id="pdf-report-content" style="padding: 20px; font-family: Arial, sans-serif;">
    <!-- Report Header -->
    <div style="border-bottom: 2px solid #2c5aa0; padding-bottom: 15px; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <h2 style="color: #2c5aa0; margin: 0; font-weight: bold;">@Model.CompanyName</h2>
                <p style="margin: 5px 0 0 0; color: #666; font-size: 12px;">
                    123 Healthcare Drive, Medical District<br>
                    Phone: (555) 123-4567 | Email: info@healthcare.com<br>
                    Medical License: MH-12345-678
                </p>
            </div>
            <div style="text-align: right;">
                <h3 style="color: #333; margin: 0; font-size: 18px;">@Model.ReportTitle</h3>
                <p style="margin: 5px 0 0 0; color: #666; font-size: 11px;">
                    Generated: @Model.GeneratedDate.ToString("yyyy-MM-dd HH:mm")<br>
                    By: @Model.GeneratedBy<br>
                    Report ID: PR-@DateTime.Now.ToString("yyyyMMddHHmmss")
                </p>
            </div>
        </div>
    </div>

    <!-- Patient Information -->
    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #ddd;">
        <table style="width: 100%; border-collapse: collapse;">
            <tr>
                <td style="width: 50%; vertical-align: top;">
                    <h4 style="color: #2c5aa0; margin: 0 0 10px 0; font-size: 14px;">PATIENT INFORMATION</h4>
                    <table style="width: 100%; font-size: 12px;">
                        <tr>
                            <td style="width: 100px; font-weight: bold; padding: 2px 0;">Patient:</td>
                            <td style="padding: 2px 0;">@Model.PatientName</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; padding: 2px 0;">Report Period:</td>
                            <td style="padding: 2px 0;">@Model.ReportPeriod</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; padding: 2px 0;">Date Range:</td>
                            <td style="padding: 2px 0;">
                                @(Model.FromDate?.ToString("yyyy-MM-dd") ?? "Start") to @(Model.ToDate?.ToString("yyyy-MM-dd") ?? "End")
                            </td>
                        </tr>
                    </table>
                </td>
                <td style="width: 50%; vertical-align: top;">
                    <h4 style="color: #2c5aa0; margin: 0 0 10px 0; font-size: 14px;">REPORT SUMMARY</h4>
                    <table style="width: 100%; font-size: 12px;">
                        <tr>
                            <td style="font-weight: bold; padding: 2px 0;">Vital Readings:</td>
                            <td style="padding: 2px 0;">@(Model.Vitals?.Count ?? 0)</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; padding: 2px 0;">Medications:</td>
                            <td style="padding: 2px 0;">@(Model.Medications?.Count ?? 0)</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; padding: 2px 0;">Treatments:</td>
                            <td style="padding: 2px 0;">@(Model.Treatments?.Count ?? 0)</td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; padding: 2px 0;">Total Events:</td>
                            <td style="padding: 2px 0;">@((Model.Vitals?.Count ?? 0) + (Model.Medications?.Count ?? 0) + (Model.Treatments?.Count ?? 0))</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <!-- Progress Chart -->
    <div style="margin-bottom: 25px; page-break-inside: avoid;">
        <div style="background: #2c5aa0; color: white; padding: 8px 12px; border-radius: 4px 4px 0 0;">
            <h4 style="margin: 0; font-size: 14px;">
                PROGRESS TIMELINE - VITAL SIGNS & CLINICAL EVENTS
            </h4>
        </div>
        <div style="border: 1px solid #ccc; border-top: none; padding: 15px; background: white;">
            <!-- Chart will be rendered here by JavaScript -->
            <div id="chart-container" style="height: 400px; display: flex; align-items: center; justify-content: center; background: #fafafa;">
                <div style="text-align: center; color: #666;">
                    <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 10px;"></i>
                    <div>Progress Chart - Generated from clinical data</div>
                    <small>Blood Pressure, Pulse Rate, Medications & Treatments timeline</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Clinical Events Timeline -->
    <div style="margin-bottom: 20px;">
        <div style="background: #2c5aa0; color: white; padding: 8px 12px; border-radius: 4px 4px 0 0;">
            <h4 style="margin: 0; font-size: 14px;">
                CLINICAL EVENTS TIMELINE
            </h4>
        </div>
        <div style="border: 1px solid #ccc; border-top: none;">
            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <thead style="background: #f8f9fa;">
                    <tr>
                        <th style="padding: 10px 8px; text-align: left; border-bottom: 1px solid #ddd; font-weight: bold;">
                            Date & Time
                        </th>
                        <th style="padding: 10px 8px; text-align: left; border-bottom: 1px solid #ddd; font-weight: bold;">
                            Event Type
                        </th>
                        <th style="padding: 10px 8px; text-align: left; border-bottom: 1px solid #ddd; font-weight: bold;">
                            Clinical Details
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var events = new List<(DateTime date, string type, string detail)>();
                        if (Model.Vitals != null)
                            foreach (var v in Model.Vitals)
                                events.Add((v.Date, "Vital", $"BP: {v.BP ?? "-"} | Pulse: {v.PulseRate} | Sugar: {v.SugarLevel} | Temp: {v.Temperature}"));

                        if (Model.Medications != null)
                            foreach (var m in Model.Medications)
                                events.Add((m.AdministeredDate, "Medication", $"{m.Medication?.Name ?? "Medication"} | Dosage: {m.Dosage ?? "-"} | By: {m.AdministeredBy?.FullName ?? "Staff"}"));

                        if (Model.Treatments != null)
                            foreach (var t in Model.Treatments)
                                events.Add((t.TreatmentDate, "Treatment", $"{t.TreatmentType ?? "Treatment"} | Notes: {(t.TreatmentType != null && t.TreatmentType.Length > 50 ? t.TreatmentType.Substring(0, 50) + "..." : t.TreatmentType ?? "N/A")}"));

                        var ordered = events.OrderByDescending(e => e.date).ToList();
                    }

                    @if (ordered.Any())
                    {
                        @foreach (var e in ordered)
                        {
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 8px; vertical-align: top;">
                                    <div>
                                        <strong>@e.date.ToString("MMM dd, yyyy")</strong><br>
                                        <small style="color: #666;">@e.date.ToString("HH:mm")</small>
                                    </div>
                                </td>
                                <td style="padding: 8px; vertical-align: top;">
                                    <span style="display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 10px; font-weight: bold;
                                                  background-color: @(e.type == "Vital" ? "#dc3545" : e.type == "Medication" ? "#6f42c1" : "#fd7e14"); color: white;">
                                        @e.type.ToUpper()
                                    </span>
                                </td>
                                <td style="padding: 8px; vertical-align: top;">
                                    @e.detail
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="3" style="padding: 30px; text-align: center; color: #666;">
                                No clinical events recorded for the selected criteria
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <div style="border-top: 2px solid #2c5aa0; padding-top: 10px; margin-top: 30px;">
        <table style="width: 100%; font-size: 9px; color: #666;">
            <tr>
                <td>
                    <strong>@Model.CompanyName</strong><br>
                    Electronic Health Record System | Version 1.0
                </td>
                <td style="text-align: right;">
                    Page <span class="page-number">1</span> of <span class="total-pages">1</span><br>
                    Confidential Medical Document - Do not distribute<br>
                    Generated on @DateTime.Now.ToString("yyyy-MM-dd at HH:mm:ss")
                </td>
            </tr>
        </table>
    </div>
</div>

